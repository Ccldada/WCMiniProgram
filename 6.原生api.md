## å¾®ä¿¡åŸç”Ÿ API

### 1. API åŸºç¡€

å°ç¨‹åºå¼€å‘æ¡†æ¶æä¾›ä¸°å¯Œçš„å¾®ä¿¡åŸç”Ÿ `API`ï¼Œå¯ä»¥æ–¹ä¾¿çš„è°ƒèµ·å¾®ä¿¡æä¾›çš„èƒ½åŠ›ï¼Œå¦‚è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæœ¬åœ°å­˜å‚¨ï¼Œæ”¯ä»˜åŠŸèƒ½ç­‰ï¼Œå‡ ä¹æ‰€æœ‰å°ç¨‹åºçš„ `API` éƒ½æŒ‚è½½åœ¨ `wx` å¯¹è±¡åº•ä¸‹ï¼Œä¾‹å¦‚ï¼š`wx.chooseMedia()`ã€`wx.request()`, `wx` å¯¹è±¡å®é™…ä¸Šå°±æ˜¯å°ç¨‹åºçš„å®¿ä¸»ç¯å¢ƒå¾®ä¿¡æ‰€æä¾›çš„å…¨å±€å¯¹è±¡

é€šå¸¸ï¼Œåœ¨å°ç¨‹åº API æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š
1. äº‹ä»¶ç›‘å¬ APIï¼šçº¦å®šä»¥ `on` å¼€å¤´ API ç”¨æ¥ç›‘å¬æŸä¸ªäº‹ä»¶æ˜¯å¦è§¦å‘ï¼Œä¾‹å¦‚ï¼š`wx.onThemeChange()`
2. åŒæ­¥ APIï¼šçº¦å®šä»¥ `Sync` ç»“å°¾çš„ API éƒ½æ˜¯åŒæ­¥ APIï¼Œä¾‹å¦‚ï¼š`wx.setStorageSync()`
3. å¼‚æ­¥ APIï¼šå¤§å¤šæ•° API éƒ½æ˜¯å¼‚æ­¥ APIï¼Œä¾‹å¦‚ï¼š`wx.setStorage()`


å¼‚æ­¥ API æ”¯æŒ callback & Promise ä¸¤ç§è°ƒç”¨æ–¹å¼ï¼š
1. å½“æ¥å£å‚æ•° Object å¯¹è±¡ä¸­ä¸åŒ…å« success/fail/complete æ—¶å°†é»˜è®¤è¿”å› Promise
2. éƒ¨åˆ†æ¥å£å¦‚ request, uploadFile æœ¬èº«å°±æœ‰è¿”å›å€¼ï¼Œå› æ­¤ä¸æ”¯æŒ Promise é£æ ¼çš„è°ƒç”¨æ–¹å¼ï¼Œå®ƒä»¬çš„ promisify éœ€è¦å¼€å‘è€…è‡ªè¡Œå°è£…ã€‚

[å°ç¨‹åº API ä»‹ç»](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/api.html)
[å¾®ä¿¡å°ç¨‹åº API æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/api/)
### 2. ç½‘ç»œè¯·æ±‚

**çŸ¥è¯†ç‚¹ï¼š**
åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ï¼Œå¦‚æœéœ€è¦å‘èµ· HTTPS ç½‘ç»œè¯·æ±‚éœ€è¦ä½¿ç”¨ï¼š`wx.request()`ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š
```js
wx.request({
  // æ¥å£åœ°å€ï¼Œä»…ä¸ºç¤ºä¾‹ï¼Œå¹¶éçœŸå®çš„æ¥å£åœ°å€
  url: 'example.php',
  // è¯·æ±‚çš„å‚æ•°
  data: { x: '' },
  // è¯·æ±‚æ–¹å¼
  method: 'GET|POST|PUT|DELETE',
  success (res) {
    console.log(res.data)
  },
  fail(err) {
    console.log(err)
  }
})
```

<font color="red">**æ³¨æ„ï¼šwx.request() è¯·æ±‚çš„åŸŸåéœ€è¦åœ¨å°ç¨‹åºç®¡ç†å¹³å°è¿›è¡Œé…ç½®ï¼Œå¦‚æœå°ç¨‹åºæ­£å¼ç‰ˆä½¿ç”¨wx.requestè¯·æ±‚æœªé…ç½®çš„åŸŸåï¼Œåœ¨æ§åˆ¶å°ä¼šæœ‰ç›¸åº”çš„æŠ¥é”™ã€‚**</font>

è¿™æ—¶å€™å°±éœ€è¦åœ¨å°ç¨‹åºç®¡ç†åå°è¿›è¡Œè®¾ç½®è¯·æ±‚çš„åŸŸåï¼Œæ‰“å¼€å¾®ä¿¡å…¬ä¼—åå°ï¼šç‚¹å‡»å·¦ä¾§ å¼€å‘ â†’ å¼€å‘ç®¡ç† â†’ å¼€å‘è®¾ç½® â†’ æœåŠ¡å™¨åŸŸåã€‚**åŸŸååªæ”¯æŒ `https` è€Œä¸”è¦æ±‚å·²å¤‡æ¡ˆ**

ä½†ä¸€èˆ¬æˆ‘ä»¬åœ¨å¼€å‘é˜¶æ®µæ—¶ï¼Œå¤„äºå¼€å‘é˜¶æ®µçš„æœåŠ¡å™¨æ¥å£å¯èƒ½è¿˜æ²¡éƒ¨ç½²åˆ°å¯¹åº”çš„åŸŸåä¸‹ï¼Œç»å¸¸ä¼šé€šè¿‡å¦ä¸€ä¸ªåŸŸåæ¥è¿›è¡Œå¼€å‘è°ƒè¯•ï¼Œè€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œä¸ºäº†æ–¹ä¾¿å¼€å‘è€…è¿›è¡Œå¼€å‘è°ƒè¯•ï¼Œå¼€å‘è€…å·¥å…·ã€å°ç¨‹åºçš„å¼€å‘ç‰ˆå’Œå°ç¨‹åºçš„ä½“éªŒç‰ˆåœ¨æŸäº›æƒ…å†µä¸‹å…è®¸ `wx.request` è¯·æ±‚ä»»æ„åŸŸå (åªé€‚ç”¨äºå¼€å‘ç¯å¢ƒï¼Œåªèƒ½åœ¨å°ç¨‹åºå¼€å‘è€…å·¥å…·ä¸­ç”Ÿæ•ˆ)ï¼Œåœ¨å¼€å‘å·¥å…·ä¸­è®¾ç½®æ­¥éª¤å¦‚ä¸‹ï¼š

å°† **ä¸æ ¡éªŒåˆæ³•åŸŸåã€web-view (ä¸šåŠ¡åŸŸå)ã€TLSç‰ˆæœ¬ä»¥åŠHTTPSè¯ä¹¦** å‹¾é€‰ä¸Šï¼š

> ğŸ“Œ **æ³¨æ„äº‹é¡¹ï¼š**
> â€‹	è¿™ä¸¤ç§æ–¹å¼åªé€‚ç”¨äºå¼€å‘è€…å·¥å…·ã€å°ç¨‹åºçš„å¼€å‘ç‰ˆå’Œå°ç¨‹åºçš„ä½“éªŒç‰ˆ
> â€‹	é¡¹ç›®ä¸Šçº¿å‰å¿…é¡»åœ¨å°ç¨‹åºç®¡ç†å¹³å°è¿›è¡Œåˆæ³•åŸŸåçš„é…ç½®

**è½åœ°ä»£ç ï¼š**
```js
Page({
  // é¡µé¢çš„åˆå§‹æ•°æ®
  data: {},

  // è·å–æ•°æ®
  getPostInfo() {
    wx.request({
      url: 'https://jsonplaceholder.typicode.com/posts/1',
      method: 'GET',
      success(res) {
        console.log(res)
      },
      fail(err) {
        console.log(err)
      }
    })
  },
    
  // coding...
}
```

### 3. ç•Œé¢äº¤äº’

å°ç¨‹åºè¿˜æä¾›äº†ä¸€äº›ç”¨äºç•Œé¢äº¤äº’çš„ APIï¼Œå¦‚æ¶ˆæ¯æç¤ºæ¡†ã€æ¨¡æ€å¯¹è¯æ¡†ã€ loading æç¤ºæ¡†ç­‰ç­‰
#### 3.1 loading æç¤ºæ¡†

å°ç¨‹åºæä¾›äº†ä¸€äº›ç”¨äºç•Œé¢äº¤äº’çš„ APIï¼Œä¾‹å¦‚ï¼š loading æç¤ºæ¡†ã€æ¶ˆæ¯æç¤ºæ¡†ã€æ¨¡æ€å¯¹è¯æ¡†ç­‰ APIã€‚
loading æç¤ºæ¡†å¸¸é…åˆç½‘ç»œè¯·æ±‚æ¥ä½¿ç”¨ï¼Œç”¨äºå¢åŠ ç”¨æˆ·ä½“éªŒï¼Œå¯¹åº”çš„ API æœ‰ä¸¤ä¸ªï¼š
1. `wx.showLoading` æ˜¾ç¤ºåŠ è½½æç¤ºæ¡†
2. `wx.hideLoading` éšè—åŠ è½½æç¤ºæ¡†
è¯­æ³•å¦‚ä¸‹ï¼š
```js
wx.showLoading({
  title: 'æç¤ºå†…å®¹', // æç¤ºçš„å†…å®¹
  mask: true, // æ˜¯å¦æ˜¾ç¤ºé€æ˜è’™å±‚ï¼Œé˜²æ­¢è§¦æ‘¸ç©¿é€
  success() {}, // æ¥å£è°ƒç”¨æˆåŠŸçš„å›è°ƒå‡½æ•°
  fail() {} // æ¥å£è°ƒç”¨å¤±è´¥çš„å›è°ƒå‡½æ•°
})
```

å®˜æ–¹æ–‡æ¡£ï¼š
[wx.showLoading å®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showLoading.html)
[wx.hideLoading å®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.hideLoading.html)
**è½åœ°ä»£ç ï¼š**

```js
Page({

  data: {
    list: []
  },

  // è·å–æ•°æ®
  getData () {

+     // æ˜¾ç¤º loading æç¤ºæ¡†
+     wx.showLoading({
+       // ç”¨æ¥æ˜¾ç¤ºæç¤ºçš„å†…å®¹
+       // æç¤ºçš„å†…å®¹ä¸ä¼šè‡ªåŠ¨æ¢è¡Œï¼Œå¦‚æœæç¤ºçš„å†…å®¹æ¯”è¾ƒå¤šï¼Œå› ä¸ºåœ¨åŒä¸€è¡Œå±•ç¤º
+       // å¤šå‡ºæ¥çš„å†…å®¹å°±ä¼šè¢«éšè—
+       title: 'æ•°æ®åŠ è½½ä¸­...',
+       // æ˜¯å¦å±•ç¤ºé€æ˜è’™å±‚ï¼Œé˜²æ­¢è§¦æ‘¸ç©¿é€
+       mask: true
+     })

    // å¦‚æœéœ€è¦å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œéœ€è¦ä½¿ç”¨ wx.request API
    wx.request({
      // æ¥å£åœ°å€
      url: 'https://gmall-prod.atguigu.cn/mall-api/index/findBanner',
      // è¯·æ±‚æ–¹å¼
      method: 'GET',
      // è¯·æ±‚å‚æ•°
      data: {},
      // è¯·æ±‚å¤´
      header: {},
      // API è°ƒç”¨æˆåŠŸä»¥åï¼Œæ‰§è¡Œçš„å›è°ƒ
      success: (res) => {
        // console.log(res)
        if (res.data.code === 200) {
          this.setData({
            list: res.data.data
          })
        }
      },
      // API è°ƒç”¨å¤±è´¥ä»¥åï¼Œæ‰§è¡Œçš„å›è°ƒ
      fail: (err) => {
        console.log(err)
      },
      // API ä¸ç®¡è°ƒç”¨æˆåŠŸè¿˜æ˜¯å¤±è´¥ä»¥åï¼Œæ‰§è¡Œçš„å›è°ƒ
      complete: (res) => {
        // console.log(res)

+         // å…³æ‰ loading æç¤ºæ¡†
+         // hideLoading å’Œ showLoading å¿…é¡»ç»“åˆã€é…å¯¹ä½¿ç”¨æ‰å¯ä»¥
+         wx.hideLoading()
      }
    })

  }

})

```

#### 3.2 æ¨¡æ€å¯¹è¯æ¡†ä»¥åŠæ¶ˆæ¯æç¤ºæ¡†

**çŸ¥è¯†ç‚¹ï¼š**
`wx.showToast()`ï¼šæ¶ˆæ¯æç¤ºæ¡†ç”¨æ¥æ ¹æ®ç”¨æˆ·çš„æŸäº›æ“ä½œæ¥å‘ŠçŸ¥æ“ä½œçš„ç»“æœï¼Œå¦‚é€€å‡ºæˆåŠŸç»™ç”¨æˆ·æç¤ºï¼Œæç¤ºåˆ é™¤æˆåŠŸç­‰ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š

```js
wx.showToast({
  title: 'æ ‡é¢˜', // æç¤ºçš„å†…å®¹
  duration: 2000, // æç¤ºçš„å»¶è¿Ÿæ—¶é—´
  mask: true, // æ˜¯å¦æ˜¾ç¤ºé€æ˜è’™å±‚ï¼Œé˜²æ­¢è§¦æ‘¸ç©¿é€
  icon: 'success', // 	å›¾æ ‡
  success() {}, // æ¥å£è°ƒç”¨æˆåŠŸçš„å›è°ƒå‡½æ•°
  fail() {} // æ¥å£è°ƒç”¨å¤±è´¥çš„å›è°ƒå‡½æ•°
})
```

`wx.showModal()` æ¨¡æ€å¯¹è¯æ¡†ä¹Ÿæ˜¯åœ¨é¡¹ç›®ä¸­é¢‘ç¹ä½¿ç”¨çš„ä¸€ä¸ªå°ç¨‹åº `API`ï¼Œé€šå¸¸ç”¨äºå‘ç”¨æˆ·è¯¢é—®æ˜¯å¦æ‰§è¡Œä¸€äº›æ“ä½œï¼Œä¾‹å¦‚ï¼šç‚¹å‡»é€€å‡ºç™»å½•ï¼Œæ˜¾ç¤ºæ¨¡æ€å¯¹è¯æ¡†ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦çœŸçš„éœ€è¦é€€å‡ºç­‰ç­‰

```js
wx.showModal({
  title: 'æç¤º', // æç¤ºçš„æ ‡é¢˜
  content: 'æ‚¨ç¡®å®šæ‰§è¡Œè¯¥æ“ä½œå—ï¼Ÿ', // æç¤ºçš„å†…å®¹
  confirmColor: '#f3514f',
  // æ¥å£è°ƒç”¨ç»“æŸçš„å›è°ƒå‡½æ•°ï¼ˆè°ƒç”¨æˆåŠŸã€å¤±è´¥éƒ½ä¼šæ‰§è¡Œï¼‰
  success({ confirm }) {
    confirm && consle.log('ç‚¹å‡»äº†ç¡®å®š')
  }
})
```

å®˜æ–¹æ–‡æ¡£ï¼š
[wx.showToast å®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showToast.html)
[wx.showModal å®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showModal.html)

```js
Page({
  // coding...
  
  // åˆ é™¤å•†å“
  async delHandler () {

    // showModal æ˜¾ç¤ºæ¨¡æ€å¯¹è¯æ¡†
    const { confirm } = await wx.showModal({
      title: 'æç¤º',
      content: 'æ˜¯å¦åˆ é™¤è¯¥å•†å“ ?'
    })

    if (confirm) {
      // showToast æ¶ˆæ¯æç¤ºæ¡†
      wx.showToast({
        title: 'åˆ é™¤æˆåŠŸ',
        icon: 'none',
        duration: 2000
      })
    } else {
      wx.showToast({
        title: 'å–æ¶ˆåˆ é™¤',
        icon: 'error',
        duration: 2000
      })
    }

  }
   
  // coding...

})
```

### 4. æœ¬åœ°å­˜å‚¨

å°ç¨‹åºä¸­ä¹Ÿèƒ½å¤Ÿåƒç½‘é¡µä¸€æ ·æ”¯æŒæœ¬åœ°æ•°æ®ç¼“å­˜ï¼Œæœ¬åœ°æ•°æ®ç¼“å­˜æ˜¯å°ç¨‹åºå­˜å‚¨åœ¨å½“å‰è®¾å¤‡ä¸Šç¡¬ç›˜ä¸Šçš„æ•°æ®ï¼Œæœ¬åœ°æ•°æ®ç¼“å­˜æœ‰éå¸¸å¤šçš„ç”¨é€”ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æœ¬åœ°æ•°æ®ç¼“å­˜æ¥å­˜å‚¨ç”¨æˆ·åœ¨å°ç¨‹åºä¸Šäº§ç”Ÿçš„æ“ä½œï¼Œåœ¨ç”¨æˆ·å…³é—­å°ç¨‹åºé‡æ–°æ‰“å¼€æ—¶å¯ä»¥æ¢å¤ä¹‹å‰çš„çŠ¶æ€ã€‚æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨æœ¬åœ°ç¼“å­˜ä¸€äº›æœåŠ¡ç«¯éå®æ—¶çš„æ•°æ®æé«˜å°ç¨‹åºè·å–æ•°æ®çš„é€Ÿåº¦ï¼Œåœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹å¯ä»¥æé«˜é¡µé¢çš„æ¸²æŸ“é€Ÿåº¦ï¼Œå‡å°‘ç”¨æˆ·çš„ç­‰å¾…æ—¶é—´ã€‚å…¶åŒ…å«ä»¥ä¸‹ 8ä¸ªä¸»è¦çš„ API

| åŒæ­¥ API               | å¼‚æ­¥ API              | ä½œç”¨                                |
| ---------------------- | --------------------- | ----------------------------------- |
| `wx.setStorageSync`    | `wx.setStorage`       | å°†æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ç¼“å­˜ä¸­æŒ‡å®šçš„ key ä¸­ |
| `wx.getStorageSync`    | `wx.getStorage`       | ä»æœ¬åœ°ç¼“å­˜ä¸­åŒæ­¥è·å–æŒ‡å®š key çš„å†…å®¹ |
| `wx.removeStorageSync` | `wx.removeStorage`    | ä»æœ¬åœ°ç¼“å­˜ä¸­ç§»é™¤æŒ‡å®š key            |
| `wx.clearStorageSync`  | `wx.clearStorageSync` | æ¸…ç†æœ¬åœ°æ•°æ®ç¼“å­˜                    |

å¼‚æ­¥æ–¹å¼çš„ `API`ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™éƒ½éœ€è¦ä¼ å…¥å¯¹è±¡ç±»å‹çš„å‚æ•°

åŒæ­¥æ–¹å¼æ‰§è¡Œçš„ API åœ¨ä½¿ç”¨æ—¶ç®€æ´æ¯”è¾ƒå¥½ï¼Œç¼ºç‚¹æ˜¯åŒæ­¥ä¼šé˜»å¡ç¨‹åºæ‰§è¡Œï¼Œæ‰§è¡Œæ•ˆç‡ä¸Šç›¸è¾ƒå¼‚æ­¥ç‰ˆæœ¬è¦å·®ä¸€äº›ã€‚

> ğŸ“Œ **æ³¨æ„äº‹é¡¹**ï¼š
>
> 1. å¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œå­˜å‚¨ï¼Œæ— éœ€ä½¿ç”¨ `JSON.stringify` è½¬æ¢
> 2. å¯¹è±¡ç±»å‹çš„æ•°æ®å­˜çš„æ—¶å€™æ²¡æœ‰ä½¿ç”¨è½¬æ¢ï¼Œå› æ­¤è·å–çš„æ—¶å€™ä¹Ÿä¸éœ€è¦ä½¿ç”¨ `JSON.parse` è½¬æ¢

**è½åœ°ä»£ç ï¼š**

```html
<button type="primary" bindtap="handler" size="mini" plain bindtap="setData">
  å­˜å‚¨æ•°æ®
</button>

<button type="primary" bindtap="handler" size="mini" plain bindtap="getData">
  è·å–æ•°æ®
</button>

<button type="warn" bindtap="handler" size="mini" plain bindtap="delData">
  åˆ é™¤æ•°æ®
</button>

<button type="warn" bindtap="handler" size="mini" plain bindtap="clearData">
  ç§»é™¤æ•°æ®
</button>
```

```js
Page({

  // å°†æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°
  setStorage () {

    // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæœ¬åœ°å­˜å‚¨ä¸­æŒ‡å®šçš„ key
    // ç¬¬äºŒä¸ªå‚æ•°ï¼šéœ€è¦å­˜å‚¨çš„æ•°æ®
    // wx.setStorageSync('num', 1)

    // åœ¨å°ç¨‹åºä¸­
    // å¦‚æœå­˜å‚¨çš„æ˜¯å¯¹è±¡ç±»å‹æ•°æ®ï¼Œä¸éœ€è¦ä½¿ç”¨ JSON.stringify å’Œ JSON.parse è¿›è¡Œè½¬æ¢
    // ç›´æ¥è¿›è¡Œå­˜å‚¨å’Œè·å–å³å¯
    // wx.setStorageSync('obj', { name: 'tom', age: 10 })

    // ------------------- å¼‚æ­¥ API -------------------
 
    wx.setStorage({
      key: 'num',
      data: 1
    })

    wx.setStorage({
      key: 'obj',
      data: { name: 'jerry', age: 18 }
    })

  },

  // è·å–æœ¬åœ°å­˜å‚¨çš„æ•°æ®
  async getStorage () {

    // ä»æœ¬åœ°å­˜å‚¨çš„æ•°æ®ä¸­è·å–æŒ‡å®š key çš„æ•°æ®ã€å†…å®¹
    // const num = wx.getStorageSync('num')
    // const obj = wx.getStorageSync('obj')

    // console.log(num)
    // console.log(obj)

    // ------------------- å¼‚æ­¥ API -------------------

    const { data } = await wx.getStorage({
      key: 'obj'
    })

    console.log(data)

  },

  // åˆ é™¤æœ¬åœ°å­˜å‚¨çš„æ•°æ®
  removeStorage () {

    // ä»æœ¬åœ°ç§»é™¤æŒ‡å®š key çš„æ•°æ®ã€å†…å®¹
    // wx.removeStorageSync('num')

    // ------------------- å¼‚æ­¥ API -------------------

    wx.removeStorage({
      key: 'num'
    })

  },

  // æ¸…ç©ºæœ¬åœ°å­˜å‚¨çš„å…¨éƒ¨æ•°æ®
  clearStorage () {
    // wx.clearStorageSync()
      
    // ------------------- å¼‚æ­¥ API -------------------

    wx.clearStorage()
  },

})

```

### 5. è·¯ç”±ä¸é€šä¿¡

åœ¨å°ç¨‹åºä¸­å®ç°é¡µé¢çš„è·³è½¬ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š

1. å£°æ˜å¼å¯¼èˆªï¼š`navigator` ç»„ä»¶
2. ç¼–ç¨‹å¼å¯¼èˆªï¼šä½¿ç”¨å°ç¨‹åºæä¾›çš„ `API`
   - `wx.navigateTo()`ï¼šä¿ç•™å½“å‰é¡µé¢ï¼Œè·³è½¬åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢ï¼Œä½†æ˜¯ä¸èƒ½è·³åˆ° tabbar é¡µé¢
   - `wx.redirectTo()`ï¼šå…³é—­å½“å‰é¡µé¢ï¼Œè·³è½¬åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢ã€‚ä½†æ˜¯ä¸å…è®¸è·³è½¬åˆ° tabbar é¡µé¢
   - `wx.switchTab()`ï¼šè·³è½¬åˆ° tabBar é¡µé¢ï¼Œè·¯å¾„åä¸èƒ½å¸¦å‚æ•°
   - `wx.navigateBack()`ï¼šå…³é—­å½“å‰é¡µé¢ï¼Œè¿”å›ä¸Šä¸€é¡µé¢æˆ–å¤šçº§é¡µé¢
3. **è·¯å¾„åå¯ä»¥å¸¦å‚æ•°ï¼Œå‚æ•°éœ€è¦åœ¨è·³è½¬åˆ°çš„é¡µé¢çš„ `onLoad` é’©å­å‡½æ•°ä¸­é€šè¿‡å½¢å‚è¿›è¡Œæ¥æ”¶**
   - å‚æ•°ä¸è·¯å¾„ä¹‹é—´ä½¿ç”¨ `?` åˆ†éš”
   - å‚æ•°é”®ä¸å‚æ•°å€¼ç”¨ `=` ç›¸è¿
   - ä¸åŒå‚æ•°ç”¨ `&` åˆ†éš”
   - ä¾‹å¦‚ `path?key=value&key2=value2`

**è½åœ°ä»£ç ï¼š**

```js
Page({


  navigateTo() {

    // ä¿ç•™å½“å‰é¡µé¢ï¼Œè·³è½¬åˆ°åº”ç”¨ä¸­å…¶ä»–é¡µé¢ï¼Œä¸èƒ½è·³è½¬åˆ° tabBar é¡µé¢
    wx.navigateTo({
      url: '/pages/list/list?id=1&name=tom'
      // url: '/pages/cate/cate'
    })

  },

  redirectTo() {

    // å…³é—­(é”€æ¯)å½“å‰é¡µé¢ï¼Œè·³è½¬åˆ°åº”ç”¨ä¸­å…¶ä»–é¡µé¢ï¼Œä¸èƒ½è·³è½¬åˆ° tabBar é¡µé¢
    wx.redirectTo({
      url: '/pages/list/list?id=1&name=tom'
      // url: '/pages/cate/cate'
    })

  },

  switchTab() {

    // è·³è½¬åˆ° tabBar é¡µé¢ï¼Œä¸èƒ½è·³è½¬åˆ° é tabBar é¡µé¢ï¼Œè·¯å¾„åé¢ä¸èƒ½ä¼ é€’å‚æ•°
    wx.switchTab({
      // url: '/pages/list/list'
      url: '/pages/cate/cate?id=1&name=tom'
    })

  },

  reLaunch() {

    // å…³é—­æ‰€æœ‰çš„é¡µé¢ï¼Œç„¶åè·³è½¬åˆ°åº”ç”¨ä¸­æŸä¸€ä¸ªé¡µé¢
    wx.reLaunch({
      url: '/pages/list/list?id=1&name=tom'
      // url: '/pages/cate/cate?id=1&name=tom'
    })
  }
})
```


```js
// list.js
Page({

  navigateBack() {

    // å…³é—­å½“å‰é¡µé¢ï¼Œè¿”å›ä¸Šä¸€é¡µæˆ–è€…è¿”å›å¤šçº§é¡µé¢
    // é»˜è®¤è¿”å›ä¸Šä¸€é¡µ
    wx.navigateBack({
      delta: 1
    })

  },

  onLoad(options) {
    console.log(options)
  }

})

```

### 6. äº‹ä»¶ç›‘å¬-ä¸Šæ‹‰åŠ è½½æ›´å¤š

ä¸Šæ‹‰åŠ è½½æ˜¯å°ç¨‹åºä¸­å¸¸è§çš„ä¸€ç§åŠ è½½æ–¹å¼ï¼Œå½“ç”¨æˆ·æ»‘åŠ¨é¡µé¢åˆ°åº•éƒ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åŠ è½½æ›´å¤šçš„å†…å®¹ï¼Œä»¥ä¾¿ç”¨æˆ·ç»§ç»­æµè§ˆ

å°ç¨‹åºä¸­å®ç°ä¸Šæ‹‰åŠ è½½çš„æ–¹å¼ï¼š

1.åœ¨ app.json æˆ–è€… page.json ä¸­é…ç½®è·ç¦»é¡µé¢åº•éƒ¨è·ç¦»ï¼š onReachBottomDistanceï¼›é»˜è®¤ 50px

2.åœ¨ é¡µé¢.js ä¸­å®šä¹‰ onReachBottom äº‹ä»¶ç›‘å¬ç”¨æˆ·ä¸Šæ‹‰åŠ è½½

**è½åœ°ä»£ç ï¼š**
```html
<view wx:for="{{ numList }}" wx:key="*this">{{ item }}</view>
```

```scss
/* pages/market/market.wxss */

view {
  height: 400rpx;
  display: flex;
  align-items: center;
  justify-content: center;
}

view:nth-child(odd) {
  background-color: lightskyblue;
}

view:nth-child(even) {
  background-color: lightsalmon;
}
```


```js
Page({

  data: {
    numList: [1, 2, 3]
  },

  // ç›‘å¬ç”¨æˆ·ä¸Šæ‹‰åŠ è½½
  onReachBottom() {
    // console.log('ç›‘å¬ç”¨æˆ·ä¸Šæ‹‰åŠ è½½')
    // äº§å“éœ€æ±‚ï¼š
    // å½“ç”¨æˆ·ä¸Šæ‹‰ï¼Œéœ€è¦æ•°å­—è¿›è¡Œç´¯åŠ 

    // å½“ç”¨æˆ·ä¸Šæ‹‰åŠ è½½æ—¶ï¼Œéœ€è¦å¯¹æ•°å­—è¿›è¡Œç´¯åŠ ï¼Œæ¯æ¬¡ç´¯åŠ  3 ä¸ªæ•°å­—
    // ç›®å‰æ˜¯ [1, 2, 3]ï¼Œ[1, 2, 3, 4, 5, 6]
    // æ€ä¹ˆè¿›è¡Œè¿½åŠ  ï¼Ÿ
    // è·å–ç›®å‰æ•°ç»„ä¸­æœ€åä¸€é¡¹ nï¼Œn + 1, n + 2, n + 3

    wx.showLoading({
      title: 'æ•°æ®åŠ è½½ä¸­...'
    })

    setTimeout(() => {
      // è·å–æ•°ç»„çš„æœ€åä¸€é¡¹
      const lastNum = this.data.numList[this.data.numList.length - 1]
      // å®šä¹‰éœ€è¦è¿½åŠ çš„å…ƒç´ 
      const newArr = [lastNum + 1, lastNum + 2, lastNum + 3]

      this.setData({
        numList: [...this.data.numList, ...newArr]
      })

      wx.hideLoading()
    }, 1500)

  }

})

```

### 7. äº‹ä»¶ç›‘å¬-ä¸‹æ‹‰åˆ·æ–°

ä¸‹æ‹‰åˆ·æ–°æ˜¯å°ç¨‹åºä¸­å¸¸è§çš„ä¸€ç§åˆ·æ–°æ–¹å¼ï¼Œå½“ç”¨æˆ·ä¸‹æ‹‰é¡µé¢æ—¶ï¼Œé¡µé¢ä¼šè‡ªåŠ¨åˆ·æ–°ï¼Œä»¥ä¾¿ç”¨æˆ·è·å–æœ€æ–°çš„å†…å®¹ã€‚

å°ç¨‹åºä¸­å®ç°ä¸Šæ‹‰åŠ è½½æ›´å¤šçš„æ–¹å¼ï¼š

1.åœ¨ app.json æˆ–è€… page.json ä¸­å¼€å¯å…è®¸ä¸‹æ‹‰ï¼ŒåŒæ—¶å¯ä»¥é…ç½® çª—å£ã€loading æ ·å¼ç­‰ 
2.åœ¨ é¡µé¢.js ä¸­å®šä¹‰ onPullDownRefresh äº‹ä»¶ç›‘å¬ç”¨æˆ·ä¸‹æ‹‰åˆ·æ–°

```html
<view wx:for="{{ numList }}" wx:key="*this">{{ item }}</view>
```

```scss
/* pages/market/market.wxss */

view {
  height: 400rpx;
  display: flex;
  align-items: center;
  justify-content: center;
}

view:nth-child(odd) {
  background-color: lightskyblue;
}

view:nth-child(even) {
  background-color: lightsalmon;
}
```

```js
Page({

  data: {
    numList: [1, 2, 3]
  },

  // ç›‘å¬ç”¨æˆ·ä¸Šæ‹‰åŠ è½½
  onReachBottom() {
    
     // coding...

  },

  // ç›‘å¬ç”¨æˆ·ä¸‹æ‹‰åˆ·æ–°
  onPullDownRefresh () {
    // console.log('ç›‘å¬ç”¨æˆ·ä¸‹æ‹‰åˆ·æ–°')

    // äº§å“éœ€æ±‚ï¼š
    // å½“ç”¨æˆ·ä¸Šæ‹‰åŠ è½½æ›´å¤šä»¥åï¼Œå¦‚æœç”¨æˆ·è¿›è¡Œäº†ä¸‹æ‹‰åˆ·æ–°
    // éœ€è¦å°†æ•°æ®è¿›è¡Œé‡ç½®
    this.setData({
      numList: [1, 2, 3]
    })

    // åœ¨ä¸‹æ‹‰åˆ·æ–°ä»¥åï¼Œloading æ•ˆæœæœ‰å¯èƒ½ä¸ä¼šå›å¼¹å›å»
    if (this.data.numList.length === 3) {
      wx.stopPullDownRefresh()
    }
  }

})

```

### 8. å¢å¼º scroll-view
#### 8.1 scroll-view ä¸Šæ‹‰åŠ è½½

bindscrolltolowerï¼šæ»šåŠ¨åˆ°åº•éƒ¨/å³è¾¹æ—¶è§¦å‘
lower-thresholdï¼šè·åº•éƒ¨/å³è¾¹å¤šè¿œæ—¶ï¼Œè§¦å‘ scrolltolower äº‹ä»¶
enable-back-to-topï¼š**è®©æ»šåŠ¨æ¡è¿”å›é¡¶éƒ¨**ï¼ŒiOS ç‚¹å‡»é¡¶éƒ¨çŠ¶æ€æ ã€å®‰å“åŒå‡»æ ‡é¢˜æ æ—¶ï¼Œåªæ”¯æŒç«–å‘

```html
<scroll-view
  class="scroll-y"
  scroll-y
  lower-threshold="100"
  bindscrolltolower="getMore"
  enable-back-to-top
>

  <view wx:for="{{ arr }}" wx:key="*this">{{ item }}</view>

</scroll-view>
```

```js
// index.js
Page({

  data: {
    arr: [1, 2, 3]
  },

  // ä¸Šæ‹‰åŠ è½½æ›´å¤š
  getMore() {

    wx.showLoading({
      title: 'æ•°æ®æ­£åœ¨åŠ è½½ä¸­...'
    })

    setTimeout(() => {

      // è®°å½•å½“å‰æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ 
      let lastNum = this.data.arr[this.data.arr.length - 1]
      // æœ€åä¸€ä¸ªå…ƒç´ åŠ  1
      lastNum++
      // æ¯æ¬¡å‘æ•°ç»„ä¸­æ–°å¢ä¸‰é¡¹
      const newArr = [lastNum, lastNum + 1, lastNum + 2]

      this.setData({
        arr: [...this.data.arr, ...newArr]
      })

     // æ•°æ®è¿”å›ï¼Œéšè— Loading
     wx.hideLoading()

     wx.showToast({
       title: 'æ•°å­—è¯·æ±‚å®Œæ¯•ï¼Œä¸Šæ»‘ç»§ç»­æµè§ˆ',
       icon: 'none'
     })

    }, 1000)

  }
})
```
#### 8.2 scroll-view ä¸‹æ‹‰åˆ·æ–°

refresher-enabledï¼šå¼€å¯è‡ªå®šä¹‰ä¸‹æ‹‰åˆ·æ–°
refresher-default-styleè‡ªå®šä¹‰ä¸‹æ‹‰åˆ·æ–°é»˜è®¤æ ·å¼æ”¯æŒè®¾ç½® `black | white | none`ï¼Œ none è¡¨ç¤ºä¸ä½¿ç”¨é»˜è®¤æ ·å¼
refresher-backgroundï¼šè‡ªå®šä¹‰ä¸‹æ‹‰åˆ·æ–°åŒºåŸŸèƒŒæ™¯é¢œè‰²
bindrefresherrefreshï¼šè‡ªå®šä¹‰ä¸‹æ‹‰åˆ·æ–°çŠ¶æ€å›è°ƒ
refresher-triggeredï¼šè®¾ç½®å½“å‰ä¸‹æ‹‰åˆ·æ–°çŠ¶æ€ï¼Œ(true ä¸‹æ‹‰åˆ·æ–°è¢«è§¦å‘ï¼Œfalse è¡¨ç¤ºä¸‹æ‹‰åˆ·æ–°æœªè¢«è§¦å‘ï¼Œ**ç”¨æ¥å…³é—­ä¸‹æ‹‰æ•ˆæœ**)

```html
<scroll-view
  class="scroll-y"
  scroll-y
  lower-threshold="100"
  bindscrolltolower="getMore"
  enable-back-to-top
             
  refresher-enabled
  refresher-default-style="black"
  refresher-background="#f7f7f8"
  refresher-triggered
  bindrefresherrefresh="onrefresh"
  refresher-triggered="{{ triggered }}"
>

  <view wx:for="{{ arr }}" wx:key="*this">{{ item }}</view>

</scroll-view>
```

```js
// index.js
Page({

  data: {
    triggered: false, // æ§åˆ¶ scroll-view ä¸‹æ‹‰åˆ·æ–°æ•ˆæœ
    arr: [1, 2, 3]
  },

  // scroll-view ä¸‹æ‹‰åˆ·æ–°å›è°ƒå‡½æ•°
  onrefresh() {

    wx.showLoading({
      title: 'æ•°æ®æ­£åœ¨åŠ è½½ä¸­...'
    })

    // å®šæ—¶å™¨æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼Œ1 ç§’åæ•°æ®è¿”å›
    setTimeout(() => {

      // é‡ç½®æ•°æ®
      this.setData({
        arr: [1, 2, 3]
      })

      // æ•°æ®è¿”å›ï¼Œéšè— Loading
      wx.hideLoading()

      wx.showToast({
        title: 'ä¸‹æ‹‰åˆ·æ–°å®Œæˆï¼Œæ•°æ®å·²é‡ç½®...',
        icon: 'none'
      })

      // æ•°æ®è¿”å›ï¼Œå…³é—­ scroll-view ä¸‹æ‹‰åˆ·æ–°æ•ˆæœ
      this.setData({
        triggered: false
      })

    }, 1000)
  }
})
```

#### 8.3 å¢å¼º scroll-view å®Œæ•´ä»£ç 

```html
<scroll-view
  scroll-y
  class="scroll-y"

  lower-threshold="100"
  bindscrolltolower="getMore"
  enable-back-to-top

  refresher-enabled
  refresher-default-style="black"
  refresher-background="#f7f7f8"
  bindrefresherrefresh="refreshHandler"
  refresher-triggered="{{isTriggered}}"
>
  
  <view wx:for="{{ numList }}" wx:key="*this">{{ item }}</view>

</scroll-view>
```

```scss
/* pages/index/index.wxss */

.scroll-y {
  height: 100vh;
  background-color: #efefef;
}

view {
  height: 500rpx;
  display: flex;
  align-items: center;
  justify-content: center;
}

view:nth-child(odd) {
  background-color: skyblue;
} 

view:nth-child(even) {
  background-color: lightsalmon;
}

```

```js

Page({

  data: {
    numList: [1, 2, 3],
    isTriggered: false
  },

  // ä¸‹æ‹‰åˆ·æ–°
  refreshHandler () {

    wx.showToast({
      title: 'ä¸‹æ‹‰åˆ·æ–°...'
    })
    
    setTimeout(() => {
      this.setData({
        numList: [1, 2, 3],
        isTriggered: false
      })
    }, 2000)

  },


  // scroll-view ä¸Šæ‹‰åŠ è½½æ›´å¤šäº‹ä»¶çš„äº‹ä»¶å¤„ç†å‡½æ•°
  getMore () {

    
    wx.showLoading({
      title: 'æ•°æ®åŠ è½½ä¸­...'
    })

    setTimeout(() => {
      // è·å–æ•°ç»„çš„æœ€åä¸€é¡¹
      const lastNum = this.data.numList[this.data.numList.length - 1]
      // å®šä¹‰éœ€è¦è¿½åŠ çš„å…ƒç´ 
      const newArr = [lastNum + 1, lastNum + 2, lastNum + 3]

      this.setData({
        numList: [...this.data.numList, ...newArr]
      })

      wx.hideLoading()
    }, 1500)


  }

})

```
